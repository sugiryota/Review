<header class="top-page-header">
      <div class="search-bar-contents">
        <%= link_to image_tag("soundreview.png", class:"top-icon"), "/" %>

        <%= form_with(url: search_items_path, local: true, method: :get, class: "search-form",id: "niko") do |f| %>
          <%= f.text_field :keyword, placeholder: "ボタンにカーソルで音声検索", class: "input-box",id:"result-div" %>
          <button id="start-btn"  class="search-button">
            <%= image_tag "search.png", class:"search-icon" ,id: "img-btn" %>
           
          </button>
          
        <% end %>
      </div>
      <div class='nav'>
        <ul class='lists-right'>
          <% if user_signed_in? %>
          <div class="user_nav grid-6">
            <div class="profile" >
              <% if current_user.image.attached? %>
                <%= image_tag current_user.image, class: "user-icon" %>
              <% else %>
                <%= image_tag "willy.png", alt: "user-icon", size: "200", class: "user-icon" %>
              <% end %>

            </div>
            <div class="right-head">
              <%= link_to current_user.nickname, user_path(current_user.id), class: "post" %>
              <%= link_to "ログアウト", destroy_user_session_path, method: :delete ,class:"post" %>
            </div>
          </div>
          <% else %>
          <div class="user_sign grid-6">
            <%= link_to "ログイン", new_user_session_path, class: "post" %>
            <%= link_to "新規登録", new_user_registration_path, class: "post" %>
          </div>
          <% end %>
        </ul>
      </div>
      <script>
        const startBtn = document.querySelector('#start-btn');
        const resultDiv = document.getElementById("result-div");
        const imgBtn = document.getElementById("img-btn")

        SpeechRecognition = webkitSpeechRecognition || SpeechRecognition;
        let recognition = new SpeechRecognition();

        recognition.lang = 'ja-JP';
        recognition.interimResults = true;
        recognition.continuous = true;

        let finalTranscript = ''; 

        recognition.onresult = (event) => {
          const interimTranscript = event.results[0][0].transcript;
          
          resultDiv.value =  interimTranscript ;
        }
        
        startBtn.addEventListener('mouseover', function(){
          recognition.start();
          
          imgBtn.src="/assets/maic.png"
          
        })
        startBtn.addEventListener('mousedown', function(){
          recognition.start();
          
          imgBtn.src="/assets/maic.png"
          
        })
        
        startBtn.addEventListener('mouseout', function(){
          recognition.stop();
          imgBtn.src="/assets/search.png"
        })

        startBtn.addEventListener('click', function(){
          recognition.stop();
          imgBtn.src="/assets/search.png"
        })
        

        
      </script>
</header>